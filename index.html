<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0d6efd">
    <meta name="description" content="Personal Subscription Manager - Track all your subscriptions in one place">
    <title>Subscription Manager</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Remixicon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="#" id="manifest-placeholder">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’³</text></svg>">
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --dark-color: #212529;
            --light-bg: #f8f9fa;
        }

        body {
            background-color: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .navbar {
            background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .install-prompt {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stats-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .stats-card .card-body {
            padding: 1.5rem;
        }

        .stats-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 1rem;
        }

        .subscription-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .subscription-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .subscription-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 10px;
            padding: 8px;
            background: white;
            border: 1px solid #e9ecef;
        }

        .subscription-type-badge {
            font-size: 0.75rem;
            padding: 0.35rem 0.65rem;
            border-radius: 6px;
            font-weight: 500;
        }

        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            border-bottom: 1px solid #e9ecef;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px 15px 0 0;
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #dee2e6;
            padding: 0.625rem 0.875rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
        }

        .btn {
            border-radius: 10px;
            padding: 0.625rem 1.25rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0a58ca 0%, #084298 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
        }

        .logo-preview {
            width: 100px;
            height: 100px;
            object-fit: contain;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            padding: 10px;
            background: white;
            margin-top: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state i {
            font-size: 5rem;
            color: #dee2e6;
            margin-bottom: 1.5rem;
        }

        .amount-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .currency-toggle {
            display: inline-flex;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .currency-toggle button {
            border: none;
            background: white;
            padding: 0.4rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.2s;
        }

        .currency-toggle button.active {
            background: var(--primary-color);
            color: white;
        }

        @media (max-width: 768px) {
            .stats-card {
                margin-bottom: 1rem;
            }
            
            .subscription-card {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="ri-bank-card-line"></i> Subscription Manager
            </span>
            <div class="currency-toggle">
                <button id="currencyINR" class="active" onclick="switchCurrency('INR')">INR</button>
                <button id="currencyUSD" onclick="switchCurrency('USD')">USD</button>
            </div>
        </div>
    </nav>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <div class="alert alert-primary alert-dismissible fade show shadow-lg" role="alert">
            <i class="ri-download-cloud-line"></i>
            <strong>Install App</strong>
            <p class="mb-2">Add Subscription Manager to your home screen for quick access!</p>
            <button class="btn btn-sm btn-light me-2" onclick="installApp()">
                <i class="ri-download-line"></i> Install
            </button>
            <button class="btn btn-sm btn-outline-light" onclick="dismissInstall()">
                Later
            </button>
            <button type="button" class="btn-close" onclick="dismissInstall()"></button>
        </div>
    </div>

    <div class="container py-4">
        <!-- Statistics Cards -->
        <div class="row mb-4" id="statsSection">
            <div class="col-md-4 mb-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon bg-primary bg-opacity-10 text-primary">
                            <i class="ri-calendar-line"></i>
                        </div>
                        <h6 class="text-muted mb-2">Monthly Spend</h6>
                        <div class="amount-display" id="monthlySpend">â‚¹0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon bg-success bg-opacity-10 text-success">
                            <i class="ri-calendar-check-line"></i>
                        </div>
                        <h6 class="text-muted mb-2">Yearly Spend</h6>
                        <div class="amount-display" id="yearlySpend">â‚¹0</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="stats-icon bg-info bg-opacity-10 text-info">
                            <i class="ri-bank-card-2-line"></i>
                        </div>
                        <h6 class="text-muted mb-2">Active Subscriptions</h6>
                        <div class="amount-display" id="totalSubscriptions">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Subscription Button -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="mb-0">My Subscriptions</h4>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSubscriptionModal">
                <i class="ri-add-line"></i> Add Subscription
            </button>
        </div>

        <!-- Subscriptions List -->
        <div id="subscriptionsList">
            <div class="empty-state">
                <i class="ri-inbox-line"></i>
                <h5 class="text-muted mb-2">No Subscriptions Yet</h5>
                <p class="text-muted">Click "Add Subscription" to start tracking your subscriptions</p>
            </div>
        </div>
    </div>

    <!-- Add/Edit Subscription Modal -->
    <div class="modal fade" id="addSubscriptionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">
                        <i class="ri-add-circle-line"></i> Add Subscription
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="subscriptionForm">
                        <input type="hidden" id="editId">
                        
                        <div class="mb-3">
                            <label for="subName" class="form-label">Subscription Name *</label>
                            <input type="text" class="form-control" id="subName" required placeholder="e.g., Netflix, Spotify">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Logo</label>
                            <div class="mb-2">
                                <input type="url" class="form-control" id="logoUrl" placeholder="Logo URL (optional)">
                            </div>
                            <div class="mb-2">
                                <label class="btn btn-outline-secondary btn-sm w-100">
                                    <i class="ri-upload-cloud-line"></i> Upload Logo
                                    <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="handleLogoUpload(this)">
                                </label>
                            </div>
                            <div id="logoPreviewContainer" style="display: none;">
                                <img id="logoPreview" class="logo-preview" alt="Logo preview">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="subType" class="form-label">Subscription Type *</label>
                            <select class="form-select" id="subType" required>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                                <option value="daily">Daily</option>
                            </select>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="amountINR" class="form-label">Amount (INR) *</label>
                                <div class="input-group">
                                    <span class="input-group-text">â‚¹</span>
                                    <input type="number" class="form-control" id="amountINR" required step="0.01" min="0" placeholder="0.00" onchange="convertCurrency('INR')">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="amountUSD" class="form-label">Amount (USD) *</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="amountUSD" required step="0.01" min="0" placeholder="0.00" onchange="convertCurrency('USD')">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="startDate" class="form-label">Start Date *</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSubscription()">
                        <i class="ri-save-line"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Exchange rate (approximate, update as needed)
        const EXCHANGE_RATE = 83; // 1 USD = 83 INR
        let currentCurrency = 'INR';
        let deferredPrompt;
        let subscriptions = [];

        // PWA Manifest
        const manifest = {
            name: "Subscription Manager",
            short_name: "SubManager",
            description: "Track all your subscriptions in one place",
            start_url: window.location.pathname,
            display: "standalone",
            background_color: "#ffffff",
            theme_color: "#0d6efd",
            orientation: "portrait",
            icons: [
                {
                    src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230d6efd' rx='20'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white'>ðŸ’³</text></svg>",
                    sizes: "512x512",
                    type: "image/svg+xml",
                    purpose: "any maskable"
                }
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set up manifest
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestURL = URL.createObjectURL(manifestBlob);
            document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);

            // Set today's date as default
            document.getElementById('startDate').valueAsDate = new Date();

            // Load subscriptions
            loadSubscriptions();

            // Service Worker Registration
            if ('serviceWorker' in navigator) {
                registerServiceWorker();
            }

            // Install prompt handler
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Check if user hasn't dismissed the prompt before
                if (!localStorage.getItem('installDismissed')) {
                    setTimeout(() => {
                        document.getElementById('installPrompt').style.display = 'block';
                    }, 3000);
                }
            });

            // Check if already installed
            window.addEventListener('appinstalled', () => {
                document.getElementById('installPrompt').style.display = 'none';
                localStorage.setItem('installDismissed', 'true');
            });
        });

        // Register Service Worker
        function registerServiceWorker() {
            const swCode = `
                const CACHE_NAME = 'subscription-manager-v1';
                
                self.addEventListener('install', (event) => {
                    self.skipWaiting();
                });

                self.addEventListener('activate', (event) => {
                    event.waitUntil(clients.claim());
                });

                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request).then((response) => {
                            return response || fetch(event.request);
                        })
                    );
                });
            `;

            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swURL)
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed:', err));
        }

        // Install App
        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    localStorage.setItem('installDismissed', 'true');
                }
                
                deferredPrompt = null;
                document.getElementById('installPrompt').style.display = 'none';
            }
        }

        // Dismiss Install Prompt
        function dismissInstall() {
            document.getElementById('installPrompt').style.display = 'none';
            localStorage.setItem('installDismissed', 'true');
        }

        // Currency Conversion
        function convertCurrency(from) {
            const inrInput = document.getElementById('amountINR');
            const usdInput = document.getElementById('amountUSD');

            if (from === 'INR') {
                const inrValue = parseFloat(inrInput.value) || 0;
                usdInput.value = (inrValue / EXCHANGE_RATE).toFixed(2);
            } else {
                const usdValue = parseFloat(usdInput.value) || 0;
                inrInput.value = (usdValue * EXCHANGE_RATE).toFixed(2);
            }
        }

        // Switch Currency Display
        function switchCurrency(currency) {
            currentCurrency = currency;
            document.getElementById('currencyINR').classList.toggle('active', currency === 'INR');
            document.getElementById('currencyUSD').classList.toggle('active', currency === 'USD');
            updateDisplay();
        }

        // Handle Logo Upload
        function handleLogoUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('logoPreview').src = e.target.result;
                    document.getElementById('logoPreviewContainer').style.display = 'block';
                    document.getElementById('logoUrl').value = ''; // Clear URL if file is uploaded
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Load Subscriptions from Local Storage
        function loadSubscriptions() {
            const stored = localStorage.getItem('subscriptions');
            subscriptions = stored ? JSON.parse(stored) : [];
            updateDisplay();
        }

        // Save Subscription
        function saveSubscription() {
            const form = document.getElementById('subscriptionForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const editId = document.getElementById('editId').value;
            const logoUrl = document.getElementById('logoUrl').value;
            const logoPreview = document.getElementById('logoPreview').src;
            
            const subscription = {
                id: editId || Date.now().toString(),
                name: document.getElementById('subName').value,
                logo: logoUrl || (logoPreview.startsWith('data:') ? logoPreview : ''),
                type: document.getElementById('subType').value,
                amountINR: parseFloat(document.getElementById('amountINR').value),
                amountUSD: parseFloat(document.getElementById('amountUSD').value),
                startDate: document.getElementById('startDate').value
            };

            if (editId) {
                const index = subscriptions.findIndex(s => s.id === editId);
                subscriptions[index] = subscription;
            } else {
                subscriptions.push(subscription);
            }

            localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addSubscriptionModal'));
            modal.hide();
            
            // Reset form
            resetForm();
            
            // Update display
            updateDisplay();
        }

        // Edit Subscription
        function editSubscription(id) {
            const subscription = subscriptions.find(s => s.id === id);
            if (!subscription) return;

            document.getElementById('modalTitle').innerHTML = '<i class="ri-edit-line"></i> Edit Subscription';
            document.getElementById('editId').value = subscription.id;
            document.getElementById('subName').value = subscription.name;
            document.getElementById('subType').value = subscription.type;
            document.getElementById('amountINR').value = subscription.amountINR;
            document.getElementById('amountUSD').value = subscription.amountUSD;
            document.getElementById('startDate').value = subscription.startDate;

            if (subscription.logo) {
                document.getElementById('logoUrl').value = subscription.logo.startsWith('data:') ? '' : subscription.logo;
                document.getElementById('logoPreview').src = subscription.logo;
                document.getElementById('logoPreviewContainer').style.display = 'block';
            }

            const modal = new bootstrap.Modal(document.getElementById('addSubscriptionModal'));
            modal.show();
        }

        // Delete Subscription
        function deleteSubscription(id) {
            if (confirm('Are you sure you want to delete this subscription?')) {
                subscriptions = subscriptions.filter(s => s.id !== id);
                localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                updateDisplay();
            }
        }

        // Reset Form
        function resetForm() {
            document.getElementById('subscriptionForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('modalTitle').innerHTML = '<i class="ri-add-circle-line"></i> Add Subscription';
            document.getElementById('logoPreviewContainer').style.display = 'none';
            document.getElementById('startDate').valueAsDate = new Date();
        }

        // Calculate Monthly Equivalent
        function calculateMonthlyAmount(amount, type) {
            switch (type) {
                case 'daily':
                    return amount * 30;
                case 'monthly':
                    return amount;
                case 'yearly':
                    return amount / 12;
                default:
                    return amount;
            }
        }

        // Update Display
        function updateDisplay() {
            const container = document.getElementById('subscriptionsList');
            
            if (subscriptions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="ri-inbox-line"></i>
                        <h5 class="text-muted mb-2">No Subscriptions Yet</h5>
                        <p class="text-muted">Click "Add Subscription" to start tracking your subscriptions</p>
                    </div>
                `;
            } else {
                container.innerHTML = subscriptions.map(sub => {
                    const amount = currentCurrency === 'INR' ? sub.amountINR : sub.amountUSD;
                    const currencySymbol = currentCurrency === 'INR' ? 'â‚¹' : '$';
                    const monthlyAmount = calculateMonthlyAmount(amount, sub.type);
                    
                    const typeColors = {
                        'monthly': 'primary',
                        'yearly': 'success',
                        'daily': 'warning'
                    };

                    const logoDisplay = sub.logo 
                        ? `<img src="${sub.logo}" class="subscription-logo" alt="${sub.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 100 100\\'><rect width=\\'100\\' height=\\'100\\' fill=\\'%23e9ecef\\'/><text x=\\'50\\' y=\\'60\\' font-size=\\'40\\' text-anchor=\\'middle\\' fill=\\'%236c757d\\'>${sub.name.charAt(0).toUpperCase()}</text></svg>'">`
                        : `<div class="subscription-logo d-flex align-items-center justify-content-center bg-light" style="font-size: 24px; font-weight: 600; color: #6c757d;">${sub.name.charAt(0).toUpperCase()}</div>`;

                    return `
                        <div class="card subscription-card">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        ${logoDisplay}
                                    </div>
                                    <div class="col">
                                        <h5 class="mb-1">${sub.name}</h5>
                                        <div class="d-flex align-items-center gap-2 flex-wrap">
                                            <span class="subscription-type-badge bg-${typeColors[sub.type]} bg-opacity-10 text-${typeColors[sub.type]}">
                                                ${sub.type.charAt(0).toUpperCase() + sub.type.slice(1)}
                                            </span>
                                            <small class="text-muted">
                                                <i class="ri-calendar-line"></i> Since ${new Date(sub.startDate).toLocaleDateString('en-IN', { month: 'short', year: 'numeric' })}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-auto text-end">
                                        <div class="h4 mb-1">${currencySymbol}${amount.toFixed(2)}</div>
                                        <small class="text-muted">~${currencySymbol}${monthlyAmount.toFixed(2)}/mo</small>
                                    </div>
                                    <div class="col-auto">
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-primary" onclick="editSubscription('${sub.id}')">
                                                <i class="ri-edit-line"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSubscription('${sub.id}')">
                                                <i class="ri-delete-bin-line"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            updateStats();
        }

        // Update Statistics
        function updateStats() {
            let monthlyTotal = 0;
            let yearlyTotal = 0;

            subscriptions.forEach(sub => {
                const amount = currentCurrency === 'INR' ? sub.amountINR : sub.amountUSD;
                const monthlyAmount = calculateMonthlyAmount(amount, sub.type);
                
                monthlyTotal += monthlyAmount;
                yearlyTotal += monthlyAmount * 12;
            });

            const currencySymbol = currentCurrency === 'INR' ? 'â‚¹' : '$';
            
            document.getElementById('monthlySpend').textContent = `${currencySymbol}${monthlyTotal.toFixed(2)}`;
            document.getElementById('yearlySpend').textContent = `${currencySymbol}${yearlyTotal.toFixed(2)}`;
            document.getElementById('totalSubscriptions').textContent = subscriptions.length;
        }

        // Reset form when modal is closed
        document.getElementById('addSubscriptionModal').addEventListener('hidden.bs.modal', function () {
            resetForm();
        });
    </script>
</body>
</html>
